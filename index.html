<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Calorie & Macro Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f172a;
      color: #e5e7eb;
    }
    .card {
      background: #020617;
      border-radius: 1rem;
      padding: 1.75rem 2rem;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    h1 {
      margin-top: 0;
      font-size: 1.5rem;
      margin-bottom: 0.25rem;
    }
    p.subtitle {
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
      color: #9ca3af;
    }
    label {
      font-size: 0.85rem;
      display: block;
      margin-bottom: 0.35rem;
      color: #e5e7eb;
    }
    .row {
      display: flex;
      gap: 0.75rem;
    }
    .field {
      margin-bottom: 0.9rem;
      width: 100%;
    }
    input, select {
      width: 100%;
      padding: 0.5rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    input:focus, select:focus {
      outline: 2px solid #38bdf8;
      outline-offset: 1px;
      border-color: transparent;
    }
    .radio-group {
      display: flex;
      gap: 0.75rem;
      font-size: 0.85rem;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
      color: #9ca3af;
    }
    button {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #06b6d4);
      color: white;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      margin-top: 0.3rem;
    }
    button:hover {
      filter: brightness(1.08);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .results {
      margin-top: 1.25rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.9rem;
    }
    .results h2 {
      margin-top: 0;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.4rem 1.2rem;
    }
    .label-sm {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .value {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .error {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #f97373;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Calorie & Macro Planner</h1>
    <p class="subtitle">Estimate daily calories and macros based on your stats and goal.</p>

    <form id="planner-form">
      <div class="field">
        <label>Sex</label>
        <div class="radio-group">
          <label><input type="radio" name="sex" value="male" checked> Male</label>
          <label><input type="radio" name="sex" value="female"> Female</label>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="age">Age (years)</label>
          <input id="age" type="number" min="14" max="100" value="20" required>
        </div>
        <div class="field">
          <label for="height">Height (cm)</label>
          <input id="height" type="number" min="130" max="230" value="173" required>
        </div>
        <div class="field">
          <label for="weight">Weight (kg)</label>
          <input id="weight" type="number" min="35" max="300" value="72" required>
        </div>
      </div>

      <div class="field">
        <label for="activity">Activity level</label>
        <select id="activity">
          <option value="sedentary">Sedentary (little/no exercise)</option>
          <option value="light">Light (1–3 days/wk)</option>
          <option value="moderate" selected>Moderate (3–5 days/wk)</option>
          <option value="very">Very active (6–7 days/wk)</option>
          <option value="extra">Extra active (physical job + training)</option>
        </select>
      </div>

      <div class="row">
        <div class="field">
          <label for="goal">Goal</label>
          <select id="goal">
            <option value="cut">Cut (lose fat)</option>
            <option value="maintain" selected>Maintain</option>
            <option value="bulk">Bulk (gain muscle)</option>
          </select>
        </div>
        <div class="field">
          <label for="pace">Pace</label>
          <select id="pace">
            <option value="slow">Slow</option>
            <option value="normal" selected>Normal</option>
            <option value="aggressive">Aggressive</option>
          </select>
        </div>
      </div>

      <button type="submit" id="submit-btn">Calculate</button>
      <div id="error" class="error" style="display:none;"></div>
    </form>

    <div id="results" class="results" style="display:none;">
      <h2>Results</h2>
      <div class="grid">
        <div>
          <div class="label-sm">BMR</div>
          <div class="value" id="res-bmr"></div>
        </div>
        <div>
          <div class="label-sm">TDEE</div>
          <div class="value" id="res-tdee"></div>
        </div>
        <div>
          <div class="label-sm">Target calories</div>
          <div class="value" id="res-calories"></div>
        </div>
        <div>
          <div class="label-sm">Weekly change</div>
          <div class="value" id="res-weekly"></div>
        </div>
      </div>

      <h2 style="margin-top:1rem;">Daily macros</h2>
      <div class="grid">
        <div>
          <div class="label-sm">Protein</div>
          <div class="value" id="res-protein"></div>
        </div>
        <div>
          <div class="label-sm">Fat</div>
          <div class="value" id="res-fat"></div>
        </div>
        <div>
          <div class="label-sm">Carbs</div>
          <div class="value" id="res-carbs"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('planner-form');
    const btn = document.getElementById('submit-btn');
    const errorBox = document.getElementById('error');
    const resultsBox = document.getElementById('results');

    const API_URL = 'http://localhost:8080/plan';

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorBox.style.display = 'none';
      resultsBox.style.display = 'none';

      const sex = form.sex.value;
      const age = Number(document.getElementById('age').value);
      const height_cm = Number(document.getElementById('height').value);
      const weight_kg = Number(document.getElementById('weight').value);
      const activity = document.getElementById('activity').value;
      const goal = document.getElementById('goal').value;
      const pace = document.getElementById('pace').value;

      if (!age || !height_cm || !weight_kg) {
        errorBox.textContent = 'Please fill in all numeric fields.';
        errorBox.style.display = 'block';
        return;
      }

      const payload = {
        sex,
        age,
        height_cm,
        weight_kg,
        activity,
        goal,
        pace
      };

      btn.disabled = true;
      btn.textContent = 'Calculating...';

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          throw new Error(errData.error || 'Server error');
        }

        const data = await res.json();

        document.getElementById('res-bmr').textContent =
          `${data.bmr.toFixed(1)} kcal`;
        document.getElementById('res-tdee').textContent =
          `${data.tdee.toFixed(1)} kcal`;
        document.getElementById('res-calories').textContent =
          `${data.targetCalories.toFixed(1)} kcal`;

        document.getElementById('res-weekly').textContent =
          `${data.weeklyChangeKg.toFixed(2)} kg / ` +
          `${data.weeklyChangeLb.toFixed(2)} lb`;

        document.getElementById('res-protein').textContent =
          `${data.macros.protein_g.toFixed(0)} g`;
        document.getElementById('res-fat').textContent =
          `${data.macros.fat_g.toFixed(0)} g`;
        document.getElementById('res-carbs').textContent =
          `${data.macros.carbs_g.toFixed(0)} g`;

        resultsBox.style.display = 'block';
      } catch (err) {
        errorBox.textContent = err.message;
        errorBox.style.display = 'block';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Calculate';
      }
    });
  </script>
</body>
</html>
